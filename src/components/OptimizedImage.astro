---
import { getBlurredImageUrl } from '@/utils/get-blurred-image-url'
import { getOptimizedImageUrl } from '@/utils/get-optimized-image-url'
import type { GetImageResult, ImageMetadata } from 'astro'
import { Image } from 'astro:assets'

type ImageSource = string | ImageMetadata | Promise<{ default: ImageMetadata }>

type Props = {
  src: ImageSource
  alt: string
  class?: string
  width?: number
  height?: number
}

const { src, alt, class: className, width, height } = Astro.props

const imageObject = await getOptimizedImageUrl({ src, width, height })

const blurredPlaceholder = await getBlurredImageUrl(imageObject)
---

<div class:list={['relative overflow-hidden', className]}>
  {/* Blurred placeholder */}
  <Image
    src={blurredPlaceholder as GetImageResult['src']}
    alt={`${alt} - Blurred placeholder`}
    inferSize
    class="absolute inset-0 h-full w-full scale-110 transform blur-xl"
    aria-hidden="true"
    style="opacity: 1; transition: opacity 0.4s ease-in-out;"
  />

  {/* Main image */}
  <Image
    src={imageObject as GetImageResult['src']}
    alt={alt}
    inferSize
    class="relative h-full w-full object-cover"
    style="opacity: 0; transition: opacity 0.4s ease-in-out;"
    onload="this.style.opacity = 1; this.previousElementSibling.style.opacity = 0;"
  />
</div>
